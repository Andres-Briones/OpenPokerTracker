<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker Hand Replayer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div>
        <h2>Poker Hand Replayer</h2>
        <input type="file" id="handFile" name="file">
        <button onclick="uploadFile()">Upload Hand File</button>
    </div>
    
    <div id="gameInfo">
        <h3>Current Game State</h3>
        <p><strong>Round:</strong> <span id="roundDisplay">N/A</span></p>
        <p><strong>Action Description:</strong> <span id="descriptionDisplay">N/A</span></p>
        <p><strong>Pot:</strong> <span id="potDisplay">0</span></p>
        <p><strong>Board:</strong> <span id="boardDisplay">None</span></p>
        <ul id="playersList"></ul>
    </div>
    
    <div class="navigation-buttons">
        <button onclick="prevAction()">Previous</button>
        <button onclick="nextAction()">Next</button>
    </div>

    <script>
        let gameStateTable = [];
        let currentActionIndex = 0;

        async function uploadFile() {
            const fileInput = document.getElementById('handFile');
            if (!fileInput.files.length) {
                alert("Please select a file first.");
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.message === "File uploaded successfully") {
                    gameStateTable = data.game_state_table;
                    currentActionIndex = 0;
                    displayAction(gameStateTable[currentActionIndex]);
                } else {
                    alert("Error uploading file: " + data.error);
                }
            } catch (error) {
                console.error("Upload failed:", error);
            }
        }

        function displayAction(action) {
            if (!action) return;

            document.getElementById('roundDisplay').textContent = action.round;
            document.getElementById('potDisplay').textContent = action.pot.toFixed(2);
            document.getElementById('boardDisplay').textContent = action.board.join(", ") || "None";
            document.getElementById('descriptionDisplay').textContent = action.description;

            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';  // Clear previous list

            action.players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = `${player.name} | Chips: ${player.chips} | Status: ${player.status} | Bet: ${player.actual_bet} | Cards: ${player.cards}`;
                playersList.appendChild(li);
            });
        }

        async function nextAction() {
            if (currentActionIndex < gameStateTable.length - 1) {
                currentActionIndex++;
                displayAction(gameStateTable[currentActionIndex]);
            } else {
                alert("No more actions.");
            }
        }

        async function prevAction() {
            if (currentActionIndex > 0) {
                currentActionIndex--;
                displayAction(gameStateTable[currentActionIndex]);
            } else {
                alert("This is the first action.");
            }
        }
    </script>
</body>
</html>
