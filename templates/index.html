<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker Hand Replayer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="boardDisplay" class="board-box">Board Cards: </div>
    <div id="potDisplay" class="info-box">Pot: 0.00</div>
    <ul id="playersList" class="players-box"></ul>
    <div id="actionDisplay" class="action-box"></div>

    <div class="navigation-buttons">
        <button onclick="prevAction()">Previous</button>
        <button onclick="nextAction()">Next</button>
    </div>

    <form id="handForm" enctype="multipart/form-data">
        <input type="file" id="handFile" name="file">
        <button type="button" onclick="uploadHand()">Upload Hand File</button>
    </form>

    <script>
        async function uploadHand() {
            const fileInput = document.getElementById('handFile');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            // Show initial state before the first action
            await nextAction();
        }

        async function nextAction() {
            const response = await fetch('/action/next');
            const actionData = await response.json();
            displayAction(actionData);
        }

        async function prevAction() {
            const response = await fetch('/action/prev');
            const actionData = await response.json();
            displayAction(actionData);
        }

        function displayAction(data) {
            if (data.message) {
                document.getElementById('actionDisplay').textContent = data.message;
                return;
            }

            document.getElementById('boardDisplay').textContent = `Board Cards: ${data.board_cards.join(", ")}`;
            document.getElementById('potDisplay').textContent = `Pot: ${data.pot.toFixed(2)}`;

            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            data.players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = `${player.name} (${player.starting_stack}) | ${player.cards} | ${player.action} | ${player.actual_bet}`;
                playersList.appendChild(li);
            });

            document.getElementById('actionDisplay').textContent = `Round: ${data.current_action.round} | ${data.current_action.player_name} ${data.current_action.action} for ${data.current_action.amount}`;
        }
    </script>
</body>
</html>
