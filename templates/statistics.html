{% extends "base.html" %}

{% block title %}Statistics{% endblock %}

{% block content %}
<h2>Statistics</h2>

<div class="mainContainerColumn">
    <div id="tableContainer" >
        <table style="width: 100%; border-collapse: collapse ; table-layout : fixed;  margin: 0; ">
            <thead style="position: sticky; top: 0; z-index: 1;">
                <tr>
                    <th>Name</th>
                    <th>Hands</th>
                    <th>VPIP (%)</th>
                    <th>PFR (%)</th>
                    <th>Win rate ($ / 100 hands)
                </tr>
            </thead>
        </table>
        <div style = "width: 100%; overflow-y: auto; max-height: 300px;">
            <table style="width: 100%; border-collapse: collapse ; table-layout : fixed;  margin: 0; ">
                <tbody>
                    {% for stat in stats %}
                    <tr class="clickable-row" onclick="location.href='{{ url_for('statistics.statistics', selected_player=stat.name) }}'">
                        <td>{{ stat.name }}</td>
                        <td>{{ stat.hands }}</td>
                        <td>{{ stat.vpip | round(2) }}</td>
                        <td>{{ stat.pfr | round(2) }}</td>
                        <td>{{ stat.win_rate | round(2) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    <div id="plotContainer" >
        <!-- Slider to control rolling window size -->
        <h3>Player Statistics</h3>
        <!-- Player Plot Display -->
        {% if selected_player %}
        <div id="plotContainer2">
            <img id="playerChart" src="{{ url_for('statistics.player_stats_plot', name=selected_player) }}" alt="Statistics for {{ selected_player }}" style="max-width: 100%; height: auto;">
        </div>

        <label for="windowSizeSlider" class="sliderLabel">
            Rolling mean window size:
            <input type="range" id="windowSizeSlider" min="5" max="100" value="10" step ="5" oninput="updatePlot()" />
            <span id="windowSizeValue">10</span>  <!-- Display slider value -->
        </label>
        {% else %}
            <div style="margin:10px">Select a player to view their statistics.</div>
        {% endif %}
    </div>
</div>

<script>
// JavaScript to handle slider changes and update the plot dynamically
function updatePlot() {
    const playerName = "{{selected_player}}";  // Player name passed from the server
    const windowSize = document.getElementById("windowSizeSlider").value;
    document.getElementById("windowSizeValue").textContent = windowSize;  // Update displayed slider value

    // Update plot image by changing the 'src' attribute with new window size
    document.getElementById("playerChart").src = `/statistics/player_stats_plot?name=${playerName}&window_size=${windowSize}`;
}
</script>

{% endblock %}
